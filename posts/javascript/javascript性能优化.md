# javascript性能优化

## 内容概要

- 内存管理
- 垃圾回收与常见GC算法
- V8引擎的垃圾回收
- Performance工具

## 内存管理

申请---使用---释放,ecmascript不像c++那样可以主动调用api完成内存管理

## 垃圾回收

什么是可达对象

- 可以访问到的对象(引用,作用域链)
- 可达的标准就是从根出发能否被找到
- javascript中的根可以理解为全局变量对象

```javascript
let obj = { name: 'zs' }
let p = obj
obj = null
// p是可达的
```

## GC算法

GC是垃圾回收机制的简写,它可以找到内存中的垃圾,并释放和回收空间

GC中的垃圾是什么? 

- 程序中不再需要使用的对象
- 程序中不能访问到的对象

### 常见的GC算法

### 引用计数

设置引用数,判断当前引用数是否为0;引用发生改变时修改引用数字,引用为0时立即回收

优点:

- 发现垃圾时立即回收
- 最大限度减少程序暂停

缺点

- 无法回收循环引用的对象
- 时间,资源开销大

#### 标记清除法

- 将整个垃圾回收机制分成两个阶段,标记和清除

- 遍历所有对象找到活动对象进行标记

- 遍历所有对象清除没有标记的对象

- 回收相应空间

优点

解决循环引用不能回收的问题

缺点

由于地址不连续导致空间碎片化
不会立即回收垃圾对象

#### 标记整理

- 标记清除的增强操作

- 标记阶段的操作和标记清除一致

- 清除阶段会先执行整理,移动对象位置

优点

减少碎片化空间

缺点

不会立即回收垃圾对象

## V8垃圾回收策略

- 采用分代回收的思想,将内存分为新生代(存活时间较短的对象),老生代
- 针对不同对象采用不同算法

V8内存分配

- V8空间一分为二
- 小空间用于存储新生代对象

新生代对象回收实现 

- 回收过程采用复制算法+标记整理
- 新生代内存分为两个等大空间
- 使用空间为From,空闲空闲为To
- 标记整理后将活动对象拷贝至To
- From和To交换空间完成释放

回收中可能出现晋升